<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Wish List | Rachmat & Dini</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Jost:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        /* =========================================
           TEMA ROYAL GLASSMORPHISM
           ========================================= */
        :root {
            --primary: #d81b60;
            --accent: #FFD700;
            --bg-pink: #fce4ec;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 10px 30px rgba(216, 27, 96, 0.15);
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

        body {
            font-family: 'Jost', sans-serif;
            background: linear-gradient(135deg, #fff0f6 0%, #ffcdd2 100%);
            min-height: 100vh; color: #444; padding-bottom: 80px;
        }

        /* HEADER */
        .page-header {
            text-align: center; padding: 40px 20px;
            position: relative; display: flex; flex-direction: column; align-items: center;
        }
        
        .header-top {
            width: 100%; display: flex; justify-content: space-between; 
            max-width: 1200px; margin-bottom: 20px; padding: 0 10px; align-items: center;
        }

        .nav-btn {
            text-decoration: none; color: var(--primary); font-size: 0.9rem;
            padding: 10px 25px; background: white; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); font-weight: 600; cursor: pointer; 
            border: 1px solid transparent; transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .nav-btn:hover { 
            background: var(--primary); color: white; 
            transform: translateY(-3px); box-shadow: 0 8px 20px rgba(216, 27, 96, 0.2); 
        }

        .title { font-family: 'Great Vibes', cursive; font-size: 4rem; color: var(--primary); margin: 5px 0; line-height: 1.2; }
        .subtitle { font-family: 'Playfair Display', serif; color: #888; font-size: 0.9rem; letter-spacing: 2px; text-transform: uppercase; border-bottom: 2px solid var(--accent); padding-bottom: 5px; }

        /* LIST CONTAINER */
        .list-container { max-width: 600px; margin: 0 auto; padding: 20px; }

        /* PROGRESS BAR */
        .progress-wrapper {
            background: white; border-radius: 50px; padding: 5px;
            box-shadow: var(--shadow); margin-bottom: 20px; position: relative;
        }
        .progress-bar {
            height: 25px; background: linear-gradient(to right, #ff80ab, var(--primary));
            border-radius: 50px; width: 0%; transition: width 0.5s ease-in-out;
        }
        .progress-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 0.85rem; font-weight: 700; color: #444; text-shadow: 0 0 10px white;
        }

        /* FILTER BUTTONS */
        .filter-container {
            display: flex; gap: 8px; justify-content: center; margin-bottom: 25px; flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px; border: 1px solid var(--primary); background: rgba(255,255,255,0.6);
            color: var(--primary); border-radius: 50px; cursor: pointer; transition: 0.3s;
            font-family: 'Jost'; font-size: 0.85rem; font-weight: 600;
        }
        .filter-btn:hover { background: #ffebee; }
        .filter-btn.active {
            background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(216, 27, 96, 0.3);
        }

        /* INPUT BOX */
        .input-box {
            display: none; flex-direction: column; gap: 10px; 
            margin-bottom: 25px; background: white; padding: 20px;
            border-radius: 15px; box-shadow: var(--shadow);
        }
        .input-row { display: flex; gap: 10px; }
        .inp-text { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Jost'; }
        .inp-select { padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Jost'; background: white; cursor: pointer; }
        .btn-add { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 700; width: 100%; transition: 0.2s; }
        .btn-add:hover { background: #ad1457; }

        /* LIST ITEMS */
        .bucket-item {
            background: var(--glass); padding: 15px 20px; border-radius: 15px;
            margin-bottom: 15px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); transition: 0.3s;
            border-left: 5px solid #ddd; position: relative; overflow: hidden;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* WARNA KATEGORI */
        .bucket-item.cat-travel { border-left-color: #29b6f6; } 
        .bucket-item.cat-food { border-left-color: #ff9800; }
        .bucket-item.cat-cafe { border-left-color: #795548; } 
        .bucket-item.cat-memory { border-left-color: #e91e63; }

        .bucket-item.done { background: #fffcf0; opacity: 0.8; }
        .bucket-item.done .item-title { text-decoration: line-through; color: #aaa; }
        .bucket-item.done .check-btn { color: var(--accent); transform: scale(1.1); } 

        .check-btn { font-size: 1.8rem; color: #ddd; cursor: pointer; transition: 0.3s; background: none; border: none; }
        .check-btn:hover { color: var(--primary); transform: scale(1.1); }

        .item-content { flex: 1; }
        .item-title { font-size: 1.1rem; font-family: 'Playfair Display', serif; font-weight: 600; }
        
        .item-tag { font-size: 0.7rem; display: inline-block; padding: 2px 8px; border-radius: 4px; margin-top: 5px; color: white; font-weight: 600; letter-spacing: 0.5px; }
        .tag-travel { background: #29b6f6; }
        .tag-food { background: #ff9800; }
        .tag-cafe { background: #795548; } 
        .tag-memory { background: #e91e63; }

        .del-btn { color: #ff6b6b; cursor: pointer; opacity: 0.5; background: none; border: none; display: none; font-size: 1rem; }
        .del-btn:hover { opacity: 1; transform: scale(1.1); }

        /* MODAL & MUSIC */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-box { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; border-top: 5px solid var(--primary); }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
        .btn-save { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: 700; }

        .music-widget { position: fixed; bottom: 30px; left: 30px; z-index: 1000; display: flex; align-items: center; gap: 15px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 10px 20px; border-radius: 50px; box-shadow: 0 10px 25px rgba(216, 27, 96, 0.2); border: 1px solid white; cursor: pointer; transition: 0.3s; }
        .music-icon { width: 40px; height: 40px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; animation: pulse 2s infinite; }
        .equalizer { display: flex; gap: 3px; height: 20px; align-items: flex-end; }
        .bar { width: 3px; background: var(--primary); animation: equalize 1s infinite alternate; }
        .bar:nth-child(2) { animation-delay: 0.2s; } .bar:nth-child(3) { animation-delay: 0.4s; }

        @keyframes equalize { 0% {height: 5px;} 100% {height: 20px;} }
        @media(max-width: 768px) { .header-top { padding: 0; margin-bottom: 10px;} .title { font-size: 3rem; } .music-text { display: none; } }
    </style>
</head>
<body>

    <header class="page-header">
        <div class="header-top">
            <a href="index.html" class="nav-btn"><i class="fa-solid fa-arrow-left"></i> Kembali</a>
            <button class="nav-btn" id="btnLogin" onclick="toggleLoginModal()">LOGIN</button>
        </div>
        <h1 class="title">Our Wish List</h1>
        <span class="subtitle">Mimpi-mimpi yang akan kita wujudkan bersama</span>
    </header>

    <div class="list-container">
        <div class="progress-wrapper">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-text" id="progressText">0% Terwujud</div>
        </div>

        <div class="filter-container">
            <button class="filter-btn btn-all active" onclick="setFilter('all')">Semua</button>
            <button class="filter-btn btn-travel" onclick="setFilter('travel')">‚úàÔ∏è Main</button>
            <button class="filter-btn btn-food" onclick="setFilter('food')">üçΩÔ∏è Kuliner</button>
            <button class="filter-btn btn-cafe" onclick="setFilter('cafe')">‚òï Cafe</button>
            <button class="filter-btn btn-memory" onclick="setFilter('memory')">‚ù§Ô∏è Sejarah</button>
        </div>

        <div class="input-box" id="inputArea">
            <div class="input-row">
                <input type="text" id="inpDream" class="inp-text" placeholder="Tulis impian baru...">
                <select id="inpCat" class="inp-select">
                    <option value="travel">‚úàÔ∏è Jalan-jalan</option>
                    <option value="food">üçΩÔ∏è Kuliner</option>
                    <option value="cafe">‚òï Ngafe</option>
                    <option value="memory">‚ù§Ô∏è Kenangan</option>
                </select>
            </div>
            <button class="btn-add" onclick="addDream()">TAMBAH KE LIST</button>
        </div>

        <div id="dreamList">
            <div style="text-align:center; margin-top:30px; color:#aaa;">
                <i class="fa-solid fa-spinner fa-spin"></i> Memuat Impian...
            </div>
        </div>
    </div>

    <div class="music-widget" onclick="toggleMusic()">
        <div class="music-icon"><i class="fa-solid fa-music"></i></div>
        <div class="equalizer"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        <div class="music-text" style="font-size: 0.85rem; color: var(--primary);"><b>One Direction - Perfect</b><br><span style="font-size:0.75rem; color:#666;">Klik putar</span></div>
    </div>
    <audio id="bgMusic" loop autoplay><source src="assets/music/peta.mp3" type="audio/mp3"></audio>

    <div class="modal" id="modalLogin">
        <div class="modal-box">
            <h3 style="margin-bottom:20px; color:var(--primary); text-align:center;">Admin Access</h3>
            <input type="email" id="email" class="form-input" placeholder="Email">
            <input type="password" id="pass" class="form-input" placeholder="Password">
            <button class="btn-save" onclick="doLogin()">Masuk</button>
            <div style="text-align:center; margin-top:15px; cursor:pointer; color:#888;" onclick="closeModals()">Batal</div>
        </div>
    </div>

    <script>
        // --- 1. CONFIG FIREBASE (PASTE PUNYAMU) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC64-tVQSGInI95H4Y763PFsc7A0zz_Df4",
            authDomain: "weblove-95a42.firebaseapp.com",
            projectId: "weblove-95a42",
            storageBucket: "weblove-95a42.firebasestorage.app",
            messagingSenderId: "270037244406",
            appId: "1:270037244406:web:c284cd60efc8cdd8874fd7",
            measurementId: "G-60WCCK5B2L"
        };

        try { firebase.initializeApp(firebaseConfig); } catch(e){}
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- 2. LOAD & FILTER LOGIC ---
        let allDreams = [];
        let currentFilter = 'all';

        db.collection('bucketlist').orderBy('created', 'desc').onSnapshot(snap => {
            allDreams = [];
            snap.forEach(doc => {
                allDreams.push({ id: doc.id, ...doc.data() });
            });
            renderList();
        });

        function setFilter(cat) {
            currentFilter = cat;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.btn-${cat}`).classList.add('active');
            renderList();
        }

        function renderList() {
            const listDiv = document.getElementById('dreamList');
            listDiv.innerHTML = '';

            const filteredData = allDreams.filter(d => {
                if (currentFilter === 'all') return true;
                return d.category === currentFilter;
            });

            let total = filteredData.length;
            let done = filteredData.filter(d => d.isDone).length;
            updateProgress(total, done);

            if (total === 0) {
                listDiv.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px">Belum ada impian di kategori ini.</p>';
                return;
            }

            filteredData.forEach(d => {
                const item = document.createElement('div');
                
                let catClass = 'cat-memory'; let tagName = 'SEJARAH ‚ù§Ô∏è'; let tagColor = 'tag-memory';
                
                if(d.category === 'travel') { catClass='cat-travel'; tagName='MAIN ‚úàÔ∏è'; tagColor='tag-travel'; }
                else if(d.category === 'food') { catClass='cat-food'; tagName='KULINER üçΩÔ∏è'; tagColor='tag-food'; }
                else if(d.category === 'cafe') { catClass='cat-cafe'; tagName='NGAFE ‚òï'; tagColor='tag-cafe'; }
                else if(d.category === 'memory') { catClass='cat-memory'; tagName='SEJARAH ‚ù§Ô∏è'; tagColor='tag-memory'; }

                const iconClass = d.isDone ? 'fa-solid fa-circle-check' : 'fa-regular fa-circle';
                item.className = `bucket-item ${d.isDone ? 'done' : ''} ${catClass}`;
                item.innerHTML = `
                    <button class="check-btn" onclick="toggleDone('${d.id}', ${d.isDone})"><i class="${iconClass}"></i></button>
                    <div class="item-content"><div class="item-title">${d.title}</div><span class="item-tag ${tagColor}">${tagName}</span></div>
                    <button class="del-btn" onclick="deleteDream('${d.id}')"><i class="fa-solid fa-trash"></i></button>
                `;
                listDiv.appendChild(item);
            });
            checkAdmin();
        }

        function addDream() {
            const title = document.getElementById('inpDream').value;
            const category = document.getElementById('inpCat').value;
            if(!title) return;
            db.collection('bucketlist').add({ title: title, category: category, isDone: false, created: firebase.firestore.FieldValue.serverTimestamp() });
            document.getElementById('inpDream').value = '';
        }

        // --- 3. EFEK CONFETTI & TOGGLE ---
        function toggleDone(id, status) {
            if (!auth.currentUser) { alert("Eits! Hanya Rachmat dan Dini yang boleh coret üòú"); return; }
            
            // JIKA DICENTANG (Belum Selesai -> Selesai), JALANKAN CONFETTI!
            if (!status) {
                triggerConfetti();
            }

            db.collection('bucketlist').doc(id).update({ isDone: !status });
        }

        function triggerConfetti() {
            var duration = 2000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

            function randomInRange(min, max) { return Math.random() * (max - min) + min; }

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) { return clearInterval(interval); }
                var particleCount = 50 * (timeLeft / duration);
                
                // Confetti dari Kiri & Kanan
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);
        }

        function deleteDream(id) { if(confirm("Hapus?")) db.collection('bucketlist').doc(id).delete(); }
        
        function updateProgress(t, d) {
            const p = t===0 ? 0 : Math.round((d/t)*100);
            document.getElementById('progressBar').style.width = p+'%';
            document.getElementById('progressText').innerText = p+'% Terwujud ('+d+'/'+t+')';
        }

        auth.onAuthStateChanged(user => {
            const btn = document.getElementById('btnLogin');
            if(user) { btn.innerText = "LOGOUT"; btn.onclick = () => auth.signOut(); document.getElementById('inputArea').style.display = 'flex'; }
            else { btn.innerText = "LOGIN"; btn.onclick = toggleLoginModal; document.getElementById('inputArea').style.display = 'none'; }
            checkAdmin();
        });
        function checkAdmin() { document.querySelectorAll('.del-btn').forEach(b => b.style.display = auth.currentUser ? 'block' : 'none'); }
        function toggleLoginModal() { document.getElementById('modalLogin').classList.add('active'); }
        function closeModals() { document.getElementById('modalLogin').classList.remove('active'); }
        function doLogin() { auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value).then(closeModals).catch(e=>alert(e.message)); }

        const music = document.getElementById('bgMusic'); 
        document.addEventListener('click', ()=>{ if(music.paused){ music.play().then(()=>{ document.querySelectorAll('.bar').forEach(b => b.style.animation = 'equalize 1s infinite alternate'); }); } }, {once:true});
        function toggleMusic() { if(!music.paused){music.pause(); document.querySelectorAll('.bar').forEach(b=>b.style.animation='none');}else{music.play(); document.querySelectorAll('.bar').forEach(b=>b.style.animation='equalize 1s infinite alternate');} }
    </script>
</body>
</html>